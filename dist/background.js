let t=null,e={timeLeft:1500,isActive:!1,isPaused:!1,currentTask:"",isBreak:!1},a=null;function c(){e.isActive&&!e.isPaused&&e.timeLeft>0&&(e.timeLeft--,n(),r(),e.timeLeft===0&&d())}function r(){try{chrome.runtime.sendMessage({type:"STATE_UPDATE",state:e}).catch(()=>{})}catch{}}function n(){const i=Math.floor(e.timeLeft/60),s=e.timeLeft%60;chrome.action.setBadgeText({text:`${i}:${s.toString().padStart(2,"0")}`}),chrome.action.setBadgeBackgroundColor({color:e.isBreak?"#22C55E":"#15243D"})}function d(){try{t&&chrome.windows.update(t.id,{focused:!0}).catch(()=>{t=null}),chrome.notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Quarter Focus",message:e.isBreak?"Break time is over. Ready to focus!":"Time for a break!"}),e.isBreak=!e.isBreak,e.timeLeft=e.isBreak?300:1500,e.isActive=!0,e.isPaused=!1,a||(a=setInterval(c,1e3)),n(),r()}catch(i){console.error("Timer completion failed:",i)}}chrome.runtime.onMessage.addListener((i,s,o)=>{switch(i.type){case"START_TIMER":e.currentTask=i.payload.currentTask,e.isActive=!0,e.isPaused=!1,a||(a=setInterval(c,1e3)),n(),r();break;case"PAUSE_TIMER":e.isPaused=!0,n(),r();break;case"RESUME_TIMER":e.isPaused=!1,a||(a=setInterval(c,1e3)),n(),r();break;case"STOP_TIMER":a&&(clearInterval(a),a=null),e.isActive=!1,e.isPaused=!1,e.timeLeft=1500,e.currentTask="",e.isBreak=!1,chrome.action.setBadgeText({text:""}),r();break;case"GET_STATE":return o(e),!0}});chrome.action.onClicked.addListener(async()=>{if(t)try{await chrome.windows.update(t.id,{focused:!0});return}catch{t=null}t=await chrome.windows.create({url:"index.html",type:"popup",width:400,height:600,focused:!0}),chrome.windows.onRemoved.addListener(function s(o){o===(t==null?void 0:t.id)&&(t=null,chrome.windows.onRemoved.removeListener(s))})});chrome.runtime.onStartup.addListener(()=>{t=null});
