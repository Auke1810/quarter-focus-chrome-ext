let t=null,e={timeLeft:1500,isActive:!1,isPaused:!1,currentTask:"",isBreak:!1},s=null;function c(){e.isActive&&!e.isPaused&&e.timeLeft>0&&(e.timeLeft--,o(),i(),e.timeLeft===0&&f())}function i(){try{chrome.runtime.sendMessage({type:"STATE_UPDATE",state:e}).catch(()=>{})}catch{}}function o(){const a=Math.floor(e.timeLeft/60),r=e.timeLeft%60;chrome.action.setBadgeText({text:`${a}:${r.toString().padStart(2,"0")}`}),chrome.action.setBadgeBackgroundColor({color:e.isBreak?"#22C55E":"#15243D"})}function f(){try{t&&chrome.windows.update(t.id,{focused:!0}).catch(()=>{t=null}),chrome.notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Quarter Focus",message:e.isBreak?"Break time is over. Ready to focus!":"Time for a break!",silent:!0}),chrome.runtime.sendMessage({type:"PLAY_NOTIFICATION_SOUND"}).catch(()=>{console.log("No active popup to play sound")}),e.isBreak=!e.isBreak,e.timeLeft=e.isBreak?300:1500,e.isBreak?(e.isActive=!0,e.isPaused=!1,s||(s=setInterval(c,1e3))):(e.isActive=!1,e.isPaused=!1,s&&(clearInterval(s),s=null)),o(),i()}catch(a){console.error("Timer completion failed:",a)}}chrome.runtime.onMessage.addListener((a,r,n)=>{switch(a.type){case"START_TIMER":e.currentTask=a.payload.currentTask,e.isActive=!0,e.isPaused=!1,s||(s=setInterval(c,1e3)),o(),i();break;case"PAUSE_TIMER":e.isPaused=!0,o(),i();break;case"RESUME_TIMER":e.isPaused=!1,s||(s=setInterval(c,1e3)),o(),i();break;case"STOP_TIMER":s&&(clearInterval(s),s=null),e.isActive=!1,e.isPaused=!1,e.timeLeft=1500,e.currentTask="",e.isBreak=!1,chrome.action.setBadgeText({text:""}),i();break;case"GET_STATE":return n(e),!0}});chrome.action.onClicked.addListener(async()=>{if(t)try{await chrome.windows.update(t.id,{focused:!0});return}catch{t=null}const{width:a}=await chrome.windows.getLastFocused(),r=400,n=600,d=Math.round((a-r)/2);t=await chrome.windows.create({url:"index.html",type:"popup",width:r,height:n,left:d,top:100,focused:!0}),chrome.windows.onRemoved.addListener(function l(u){u===(t==null?void 0:t.id)&&(t=null,chrome.windows.onRemoved.removeListener(l))})});chrome.runtime.onStartup.addListener(()=>{t=null});
