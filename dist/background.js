let e={timeLeft:1500,isActive:!1,isPaused:!1,currentTask:"",isBreak:!1},t=null;function o(){e.isActive&&!e.isPaused&&e.timeLeft>0&&(e.timeLeft--,c(),s(),e.timeLeft===0&&u())}function s(){try{chrome.runtime.sendMessage({type:"STATE_UPDATE",state:e}).catch(()=>{})}catch{}}function c(){const a=Math.floor(e.timeLeft/60),i=e.timeLeft%60;chrome.action.setBadgeText({text:`${a}:${i.toString().padStart(2,"0")}`}),chrome.action.setBadgeBackgroundColor({color:e.isBreak?"#22C55E":"#15243D"})}function u(){try{chrome.windows.getAll({populate:!0},a=>{const i=a.find(r=>{var n,l;return r.type==="popup"&&r.tabs&&((l=(n=r.tabs[0])==null?void 0:n.url)==null?void 0:l.includes("index.html"))});i&&chrome.windows.update(i.id,{focused:!0})}),chrome.notifications.create({type:"basic",iconUrl:"icons/icon128.png",title:"Quarter Focus",message:e.isBreak?"Break time is over. Ready to focus!":"Time for a break!"}),e.isBreak=!e.isBreak,e.timeLeft=e.isBreak?300:1500,e.isActive=!0,e.isPaused=!1,t||(t=setInterval(o,1e3)),c(),s()}catch(a){console.error("Timer completion failed:",a)}}chrome.runtime.onMessage.addListener((a,i,r)=>{switch(a.type){case"START_TIMER":e.currentTask=a.payload.currentTask,e.isActive=!0,e.isPaused=!1,t||(t=setInterval(o,1e3)),c(),s();break;case"PAUSE_TIMER":e.isPaused=!0,c(),s();break;case"RESUME_TIMER":e.isPaused=!1,t||(t=setInterval(o,1e3)),c(),s();break;case"STOP_TIMER":t&&(clearInterval(t),t=null),e.isActive=!1,e.isPaused=!1,e.timeLeft=1500,e.currentTask="",e.isBreak=!1,chrome.action.setBadgeText({text:""}),s();break;case"GET_STATE":return r(e),!0}});chrome.action.onClicked.addListener(()=>{chrome.windows.create({url:"index.html",type:"popup",width:400,height:600,focused:!0})});
